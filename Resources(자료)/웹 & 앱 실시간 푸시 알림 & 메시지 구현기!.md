# ì‹¤ì‹œê°„ í‘¸ì‹œ ì•Œë¦¼ ë° ë©”ì‹œì§€ ê¸°ëŠ¥ êµ¬í˜„

ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” **ì›¹ê³¼ ì•±ì—ì„œ ì‹¤ì‹œê°„ í‘¸ì‹œ ì•Œë¦¼ ë° ë©”ì‹œì§€ ê¸°ëŠ¥**ì„ êµ¬í˜„í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ êµ¬í˜„í•´ì•¼ í•  ê¸°ëŠ¥ì€ **ì‹¤ì‹œê°„ìœ¼ë¡œ í™”ë©´ì´ ê°±ì‹ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìƒëŒ€ë°©ì´ ëŒ“ê¸€ì„ ë‹¬ê±°ë‚˜ íŠ¹ì • í–‰ë™ì„ í–ˆì„ ë•Œ ì´ë¥¼ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

ğŸ’¡ ë‹¨ìˆœí•´ ë³´ì´ì§€ë§Œ, **ì›¹ê³¼ ì•±ì˜ í™˜ê²½ ì°¨ì´** ë•Œë¬¸ì— í•´ê²°í•´ì•¼ í•  ë¬¸ì œê°€ ê½¤ ìˆì—ˆìŠµë‹ˆë‹¤.  
ì–´ë–¤ ê¸°ìˆ ì´ ê°€ì¥ ì í•©í• ì§€ í•˜ë‚˜ì”© ëœ¯ì–´ë³´ë©° ê³ ë¯¼í•´ë´¤ìŠµë‹ˆë‹¤. ğŸ¤”

ì´ì— ë”°ë¼ ë‹¤ì–‘í•œ ë°©ë²•ì„ ê²€í† í•˜ì˜€ìœ¼ë©°, ìµœì ì˜ ì†”ë£¨ì…˜ì„ ì„ íƒí•˜ê¸° ìœ„í•´ ê°ê°ì˜ ì¥ë‹¨ì ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.

### **1. WebSocket**

WebSocketì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ **ëŠê¹€ ì—†ëŠ” ì–‘ë°©í–¥ í†µì‹ **ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.  
ğŸ‘‰ **ì‹¤ì‹œê°„ ë©”ì‹œì§•** ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ì—” ìµœê³ 

#### âœ… **ì¥ì :**  
- ì§€ì†ì ì¸ ì—°ê²° ìœ ì§€ (ë¹ ë¥¸ ì‘ë‹µ)  
- ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ì–‘ë°©í–¥ ì†Œí†µ ê°€ëŠ¥

#### âŒ **ë‹¨ì :**  
- ì„œë²„ ë¦¬ì†ŒìŠ¤ ë¶€ë‹´ì´ í¼ (ì—°ê²° ìœ ì§€ í•„ìš”)  
- ì•±ì´ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœë©´ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŒ  
- ë„¤íŠ¸ì›Œí¬ê°€ ëŠê¸°ë©´ ì•Œë¦¼ë„ ëŠê¹€

#### ğŸ”¥ **ê²°ë¡ :**  
**"ì›¹ê³¼ ì•±ì˜ í¬ê·¸ë¼ìš´ë“œ ìƒíƒœ"**ì—ì„œ ì‹¤ì‹œê°„ ë©”ì‹œì§€ì—ëŠ” ì í•©í•˜ì§€ë§Œ,  
**ë°±ê·¸ë¼ìš´ë“œ & ì˜¤í”„ë¼ì¸ í‘¸ì‹œëŠ” ë¶ˆê°€ëŠ¥**í•´ì„œ ì™„ì „í•œ ì†”ë£¨ì…˜ì€ ì•„ë‹˜.

---

### **2. Firebase Cloud Messaging (FCM)**

FCMì€ **Googleì˜ í´ë¼ìš°ë“œ ë©”ì‹œì§• ì„œë¹„ìŠ¤**ë¡œ, í‘¸ì‹œ ì•Œë¦¼ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ğŸ‘‰ **ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì´ê±°ë‚˜ ì¢…ë£Œëœ ìƒíƒœì—ì„œë„ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŒ!**

#### âœ… **ì¥ì :**  
- ì•±ì´ ì¢…ë£Œëœ ìƒíƒœì—ì„œë„ í‘¸ì‹œ ê°€ëŠ¥  
- Web, Android, iOS ëª¨ë‘ ì§€ì›  
- Google ì¸í”„ë¼ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì •ì ì´ê³  í™•ì¥ì„±ì´ ë›°ì–´ë‚¨  
- ë¬´ë£Œ ì œê³µ

#### âŒ **ë‹¨ì :**  
- Google ì„œë¹„ìŠ¤ ì˜ì¡´ì„±ì´ ìˆìŒ  
- ì™„ì „í•œ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ ì€ ì–´ë ¤ì›€ (ë³„ë„ ë°ì´í„° ë™ê¸°í™” í•„ìš”)

#### ğŸ”¥ **ê²°ë¡ :**  
**ì•±ì´ êº¼ì ¸ ìˆê±°ë‚˜ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì¼ ë•Œë„ í‘¸ì‹œê°€ í•„ìš”í•œ ê²½ìš°, FCMì´ ìµœì ì˜ ì†”ë£¨ì…˜!**  
ë‹¤ë§Œ, **ì‹¤ì‹œê°„ ì–‘ë°©í–¥ ë©”ì‹œì§•ì´ í•„ìš”í•˜ë‹¤ë©´ WebSocketê³¼ í•¨ê»˜ í™œìš©í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì **

---

### **3. Server-Sent Events (SSE)**

SSEëŠ” **ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ë‹¨ë°©í–¥ í†µì‹ **ì„ ì œê³µí•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.  
ğŸ‘‰ WebSocketì²˜ëŸ¼ ë³„ë„ì˜ í”„ë¡œí† ì½œì´ í•„ìš”í•˜ì§€ ì•Šê³  **HTTP í‘œì¤€**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### âœ… **ì¥ì :**  
- WebSocketë³´ë‹¤ êµ¬í˜„ì´ ê°„ë‹¨í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´  
- HTTP ê¸°ë°˜ì´ë¼ ë°©í™”ë²½ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„±ì´ ì ìŒ  
- ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì§€ì†ì ì¸ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë° ê°€ëŠ¥

#### âŒ **ë‹¨ì :**  
- ë‹¨ë°©í–¥ í†µì‹ ë§Œ ê°€ëŠ¥ (í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ ë°ì´í„° ì „ì†¡ ë¶ˆê°€)  
- ì•±ì´ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì¼ ë•Œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŒ  
- ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‹œ ì—°ê²° ìˆ˜ ì œí•œì´ ìˆìŒ

#### ğŸ”¥ **ê²°ë¡ :**  
ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**ë¥¼ ì „ì†¡í•˜ëŠ” ê°„ë‹¨í•œ ì›¹ ì„œë¹„ìŠ¤ì—ëŠ” ì í•©í•˜ì§€ë§Œ,  
**ì–‘ë°©í–¥ í†µì‹ ì´ í•„ìš”í•˜ê±°ë‚˜ ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì¼ ë•Œë„ ì•Œë¦¼ì„ ë°›ì•„ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ë¶€ì í•©**

---

### **4. OneSignal / Push Notifications API**

OneSignalê³¼ Push Notifications APIëŠ” ì›¹ê³¼ ì•±ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.  
ğŸ‘‰ FCMê³¼ ìœ ì‚¬í•˜ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ì†ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ì†”ë£¨ì…˜

#### âœ… **ì¥ì :**  
- í‘¸ì‹œ ì•Œë¦¼ ê¸°ëŠ¥ì„ ë¹ ë¥´ê²Œ êµ¬í˜„ ê°€ëŠ¥  
- Web, Android, iOS ë“± ë‹¤ì–‘í•œ í”Œë«í¼ ì§€ì›  
- ì‚¬ìš©ì´ ê°„í¸í•˜ê³  UI ì¹œí™”ì ì¸ ê´€ë¦¬ ë„êµ¬ ì œê³µ

#### âŒ **ë‹¨ì :**  
- OneSignalì€ ì¼ë¶€ ê¸°ëŠ¥ì´ ìœ ë£Œ (ë¹„ìš© ê³ ë ¤ í•„ìš”)  
- Push Notifications APIëŠ” ë¸Œë¼ìš°ì € ì§€ì›ì´ ì œí•œì  (íŠ¹íˆ iOS Safariì—ì„œ ì œí•œì )  
- FCM ëŒ€ë¹„ ì»¤ìŠ¤í…€ ê¸°ëŠ¥ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŒ

#### ğŸ”¥ **ê²°ë¡ :**  
**ë¹ ë¥´ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ êµ¬í˜„í•˜ê³  ì‹¶ë‹¤ë©´ ì ì ˆí•œ ì„ íƒ**ì´ì§€ë§Œ,  
**ë°±ì—”ë“œ ì»¤ìŠ¤í…€, í™•ì¥ì„±, ë¹„ìš© ë“±ì„ ê³ ë ¤í•˜ë©´ FCMì´ ë” ì í•©**

---

### **ìµœì¢… ì„ íƒ: FCM ì‚¬ìš©**

ìš°ë¦¬ëŠ” **ì™„ì „í•œ ì‹¤ì‹œê°„ í†µì‹ ì´ í•„ìš”í•˜ì§€ ì•Šê³ **,  
**í‘¸ì‹œ ì•Œë¦¼ì„ ì•ˆì •ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ê²ƒì´ ëª©í‘œ**ì´ë¯€ë¡œ **FCMë§Œ ì‚¬ìš©**í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

#### âœ… **ì•±ì´ ì¢…ë£Œëœ ìƒíƒœì—ì„œë„ í‘¸ì‹œ ê°€ëŠ¥**  
#### âœ… **êµ¬ê¸€ ì¸í”„ë¼ í™œìš© â†’ ì•ˆì •ì ì´ê³  í™•ì¥ì„± ë›°ì–´ë‚¨**  
#### âœ… **ì›¹ê³¼ ì•± ëª¨ë‘ ì§€ì›**

ì´ëŸ¬í•œ ì´ìœ ë¡œ **FCMì„ ì„ íƒ**í•˜ì˜€ìœ¼ë©°, ì´ì œ **FCMì— ëŒ€í•´ ê°„ëµíˆ ì•Œì•„ë³´ê³ , NEXT.jsì—ì„œ í† í°ì„ ë°œê¸‰ë°›ê³  ì•Œë¦¼ì„ ë°›ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.**

---

## **FCMì´ë€?**

**Firebase Cloud Messaging(FCM)** ì€ Googleì´ ì œê³µí•˜ëŠ” ë¬´ë£Œë¡œ ë©”ì‹œì§€ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” êµì°¨ í”Œë«í¼ ë©”ì‹œì§• ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.

### **FCMì„ ì“°ëŠ” ì´ìœ **

ê¸°ì¡´ì—ëŠ” iOS(APNS), Android(GCM), Web ë“± ê° í”Œë«í¼ë§ˆë‹¤ Push ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ë°©ì‹ì´ ë‹¬ë¼ **ê°ê° ë”°ë¡œ ê°œë°œí•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€**ì´ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ **FCMì€ êµì°¨ í”Œë«í¼ ë©”ì‹œì§€ ì†”ë£¨ì…˜**ì´ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì‚¬ìš©í•˜ë©´ **í•˜ë‚˜ì˜ APIë¡œ ì—¬ëŸ¬ í”Œë«í¼ì— ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.**

### **í´ë¼ìš°ë“œ ë©”ì‹œì§•ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìœ **

#### 1. ì¼ë°˜ì ì¸ 1:1 ë©”ì‹œì§€ ì „ì†¡

Aê°€ Bì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ë•Œ, ë³´í†µ ì•„ë˜ì™€ ê°™ì€ íë¦„ì„ ë”°ë¥¸ë‹¤.

**A â†’ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ â†’ B**

#### 2. ì„œë¹„ìŠ¤ì—ì„œ Bì—ê²Œ ë§ˆì¼€íŒ… ë©”ì‹œì§€ ì „ì†¡

ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ìš´ì˜í•˜ëŠ” íšŒì‚¬ê°€ Bì—ê²Œ ë§ˆì¼€íŒ… ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ê²½ìš°

**ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ â†’ B**

ì´ ë‘ ê°€ì§€ ë°©ì‹ì—ì„œ **Bê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë ¤ë©´ ì„œë²„ì— ê³„ì† ì ‘ì†í•´ ìˆì–´ì•¼ í•œë‹¤.** í•˜ì§€ë§Œ ì´ëŠ” **ë°°í„°ë¦¬ ì†Œëª¨ì™€ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰ ì¦ê°€**ë¼ëŠ” ë¬¸ì œë¥¼ ì´ˆë˜í•œë‹¤.

#### FCMì„ ì‚¬ìš©í•˜ë©´?

FCM ê°™ì€ **í´ë¼ìš°ë“œ ë©”ì‹œì§• ì„œë²„**ë¥¼ ì¤‘ê°„ì— ë‘ë©´, ì‚¬ìš©ìê°€ ì„œë²„ì— ê³„ì† ì ‘ì†í•´ ìˆì„ í•„ìš” ì—†ì´ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

**A â†’ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ â†’ FCM â†’ B**

ì´ ë°©ì‹ì€ **ë°°í„°ë¦¬ì™€ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ì„ ìµœì†Œí™”í•˜ë©´ì„œë„ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ë‹¬ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.**  
ê·¸ë˜ì„œ ëŒ€ë¶€ë¶„ì˜ ì•± ì„œë¹„ìŠ¤ê°€ **í´ë¼ìš°ë“œ ë©”ì‹œì§•ì„ í™œìš©í•´ Push ë©”ì‹œì§€ë¥¼ ì „ì†¡**í•˜ëŠ” ê²ƒì´ë‹¤.

---

## **Next.jsì—ì„œ FCM í† í°ì„ ë°œê¸‰ ë°›ê³  ì•Œë¦¼ ë°›ì•„ë³´ê¸°**

### **1. Firebaseì— í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°**

ìš°ì„  Firebaseì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ì›¹ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

ê·¸ ë‹¤ìŒ ì„¤ì •ì— ë“¤ì–´ê°„ë‹¤

í”„ë¡œì íŠ¸ ì„¤ì • -> ì¼ë°˜

ì—¬ê¸°ì„œ í•´ë‹¹ í‚¤ê°’ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![[Pasted image 20250313161622.png]]

---

### **2. Next.jsì— Firebase ì„¤ì¹˜í•˜ê¸°**

```bash
npm install firebase
```


### **3. Next.jsì— Firebase ì„¤ì • íŒŒì¼ ë§Œë“¤ê¸°**
ì´ ì½”ë“œëŠ” Firebase ì•±ì„ ì„¤ì •í•˜ê³  ì´ˆê¸°í™”í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì£¼ë¡œ Firebase Cloud Messaging (FCM)ì„ ì‚¬ìš©í•˜ì—¬ í‘¸ì‹œ ì•Œë¦¼ì„ ì²˜ë¦¬í•˜ë ¤ëŠ” ê²½ìš°ì— í•„ìš”í•œ ì„¤ì •ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
### ğŸ”¹ **ê¸°ëŠ¥ ê°œìš”**
- `initializeApp(firebaseConfig)`: Firebase ì•±ì„ ì´ˆê¸°í™”
- `getMessaging(app)`: Firebase ë©”ì‹œì§• ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- `getToken(messaging)`: FCM í† í°ì„ ìš”ì²­í•˜ì—¬ ì•Œë¦¼ì„ ë°›ì„ ì¤€ë¹„
- `onMessage(messaging, callback)`: í¬ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 

```javascript
import { getApp, getApps, initializeApp } from 'firebase/app';
import { getMessaging, getToken, Messaging, onMessage } from 'firebase/messaging';
import { isRunningInWebView } from '@/utils/utils';

// Firebase ì„¤ì • (í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©)
const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
  measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,
};

// Firebase ì•± ì´ˆê¸°í™” (ì´ë¯¸ ì•±ì´ ì¡´ì¬í•˜ë©´ ì¬ì´ˆê¸°í™” ë°©ì§€)
const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();

// Firebase Messaging ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™” (ì›¹ í™˜ê²½ì—ì„œë§Œ)
let messaging: Messaging | null = null;
if (typeof window !== 'undefined' && !isRunningInWebView()) {
  if ('serviceWorker' in navigator) {
    try {
      messaging = getMessaging(app);
      console.log('Firebase Messaging ì´ˆê¸°í™” ì„±ê³µ');
    } catch (error) {
      console.error('Firebase Messaging ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
    }
  } else {
    console.log('ì´ ë¸Œë¼ìš°ì €ëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
  }
}

// FCM í† í° ìš”ì²­ í•¨ìˆ˜
const requestForToken = async (): Promise<string | null> => {
  if (!messaging) return null;

  try {
    // ì•Œë¦¼ ê¶Œí•œ í™•ì¸
    if (Notification.permission !== 'granted') {
      const permission = await Notification.requestPermission();
      if (permission !== 'granted') {
        console.warn('ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤');
        return null;
      }
    }

    // VAPID í‚¤ë¡œ FCM í† í° ê°€ì ¸ì˜¤ê¸°
    return await getToken(messaging, {
      vapidKey: process.env.NEXT_PUBLIC_FIREBASE_VAPID_KEY,
    });
  } catch (error) {
    console.error('FCM í† í° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
    return null;
  }
};

// í•„ìš”í•œ Firebase ëª¨ë“ˆ ë° í•¨ìˆ˜ ë‚´ë³´ë‚´ê¸°
export { app, messaging, getToken, onMessage, requestForToken };
```

### **4. Firebase í‘¸ì‹œ ì•Œë¦¼ ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼ ë§Œë“¤ê¸°**(firebase-messaing-sw.js)
Firebase ì›¹ í‘¸ì‹œ ì•Œë¦¼ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” `firebase-messaging-sw.js`ë¼ëŠ” **ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼**ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì€ ë°˜ë“œì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ë£¨íŠ¸ ë””ë ‰í† ë¦¬**ì— ìœ„ì¹˜í•´ì•¼ í•˜ë©°, Next.jsì—ì„œëŠ” `public` í´ë”ì— ì €ì¥í•´ì•¼ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” ë¸Œë¼ìš°ì €ê°€ **ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” JavaScript ì½”ë“œ**ë¡œ, ì›¹ ì•±ì´ ë‹«í˜€ ìˆê±°ë‚˜ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì¼ ë•Œë„ í‘¸ì‹œ ì•Œë¦¼ì„ ìˆ˜ì‹ í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

âš ï¸ **í¬ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œë§Œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤ê³  ìƒê°í•´ì„œ ì´ íŒŒì¼ì„ ì œê±°í•˜ë©´,  í‘¸ì‹œ ì•Œë¦¼ì´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**  
Next.jsì—ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ `public` í´ë”ì— ìˆì–´ì•¼ ì œëŒ€ë¡œ ë“±ë¡ë˜ë©°, ì´ íŒŒì¼ì´ ì—†ìœ¼ë©´ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
### ğŸ”¹ **ê¸°ëŠ¥ ê°œìš”**
- `firebase.initializeApp(firebaseConfig)`: Firebase ì•±ì„ ì´ˆê¸°í™”
- `messaging.onBackgroundMessage(callback)`: ì•±ì´ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì¼ ë•Œ í‘¸ì‹œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 
- `self.registration.showNotification(title, options)`: í‘¸ì‹œ ë©”ì‹œì§€ë¥¼ ì‹¤ì œ ì•Œë¦¼ìœ¼ë¡œ í‘œì‹œ
- `self.addEventListener('notificationclick', callback)`: ì‚¬ìš©ìê°€ ì•Œë¦¼ì„ í´ë¦­í–ˆì„ ë•Œ íŠ¹ì • ë™ì‘ ìˆ˜í–‰

```javascript
importScripts('https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js');
importScripts('https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging.js');

// Firebase ì„¤ì • (í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤)
const firebaseConfig = {
  apiKey: 'YOUR_API_KEY',
  messagingSenderId: 'YOUR_MESSAGING_SENDER_ID',
};

// Firebase ì•± ì´ˆê¸°í™”
firebase.initializeApp(firebaseConfig);

// Firebase Messaging ì´ˆê¸°í™”
const messaging = firebase.messaging();

// ë°±ê·¸ë¼ìš´ë“œë“œ í‘¸ì‹œ ì•Œë¦¼ ì²˜ë¦¬
messaging.onBackgroundMessage((payload) => {
  console.log('ë°±ê·¸ë¼ìš´ë“œ í‘¸ì‹œ ë©”ì‹œì§€ ë°›ìŒ:', payload);

  // í‘¸ì‹œ ì•Œë¦¼ì˜ ì œëª©ê³¼ ë‚´ìš©ì„ ì‚¬ìš©í•˜ì—¬ ì•Œë¦¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
  const notificationTitle = payload.notification.title;
  const notificationOptions = {
    body: payload.notification.body,
    icon: payload.notification.icon,
  };

  // ì•Œë¦¼ í‘œì‹œ
  self.registration.showNotification(notificationTitle, notificationOptions);
});

// ì•Œë¦¼ í´ë¦­ ì²˜ë¦¬

self.addEventListener('notificationclick', (event) => {

Â  console.log('ì•Œë¦¼ í´ë¦­ë¨:', event);

Â  event.notification.close();

Â  const urlToOpen =  '/';

Â  event.waitUntil(

Â  Â  clients.matchAll({ type: 'window' }).then((clientList) => {

Â  Â  Â  // ì´ë¯¸ ì—´ë¦° ì°½ì´ ìˆëŠ”ì§€ í™•ì¸

Â  Â  Â  for (const client of clientList) {

Â  Â  Â  Â  if (client.url.includes(urlToOpen) && 'focus' in client) {

Â  Â  Â  Â  Â  return client.focus();

Â  Â  Â  Â  }

Â  Â  Â  }

Â  Â  Â  // ì—´ë¦° ì°½ì´ ì—†ìœ¼ë©´ ìƒˆ ì°½ ì—´ê¸°

Â  Â  Â  if (clients.openWindow) {

Â  Â  Â  Â  return clients.openWindow(urlToOpen);

Â  Â  Â  }

Â  Â  })

Â  );
});
```

### **5. ì›¹ì—ì„œ Firebase FCM í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  ë° ì²˜ë¦¬í•˜ê¸°**

ì´ì œ Firebase Cloud Messaging (FCM)ì„ ì„¤ì •í•˜ê³  í‘¸ì‹œ ì•Œë¦¼ì„ ìˆ˜ì‹ í•  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë§ˆì§€ë§‰ ë‹¨ê³„ëŠ” **FCM ë©”ì‹œì§€ ìˆ˜ì‹  ë° ì²˜ë¦¬**ì…ë‹ˆë‹¤. `WebViewMessageHandler` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ì—ì„œ FCM í‘¸ì‹œ ì•Œë¦¼ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
### ğŸ”¹ **ê¸°ëŠ¥ ê°œìš”**

- `requestForToken()`: FCM í† í°ì„ ìš”ì²­í•˜ê³  ë°˜í™˜
- `messaging.onMessage(callback)`: ì•±ì´ í¬ê·¸ë¼ìš´ë“œ ìƒíƒœì¼ ë•Œ í‘¸ì‹œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ 
- `onMessage(messaging, callback)`: FCM ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ë¦¬ìŠ¤ë„ˆ ë“±ë¡
- `console.log(token)`: ìˆ˜ì‹ í•œ FCM í† í°ì„ ì½˜ì†”ì— ì¶œë ¥ (ë¡œê·¸ì¸ ì‹œ ë°±ì—”ë“œë¡œ ì „ì†¡ ê°€ëŠ¥)

```javascript
'use client';

import { useEffect } from 'react';

import { messaging, onMessage, requestForToken } from '@/lib/firebase-config';

const FcmMessageHandler = () => {

Â  // ì›¹ FCM í† í° ìš”ì²­
Â  const getWebFcmToken = async () => {

Â  Â  const token = await requestForToken();

Â  Â  if (token) {

Â  Â  Â  console.log('FCM Token:', token);

Â  Â  } else {

Â  Â  Â  console.warn('ì›¹ì—ì„œ FCM í† í°ì„ ê°€ì ¸ì˜¤ì§€ ëª»í•¨');

Â  Â  }

Â  };

Â  // FCM ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •

Â  const setupFcmMessageListener = () => {

Â  Â  if (!messaging) {
Â  Â  Â  console.error('Firebase Messagingì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
Â  Â  Â  return;
Â  Â  }

Â  Â  return onMessage(messaging, (payload) => {
Â  Â  Â  console.log('FCM Payload:', payload);
Â  Â  Â  console.log('payload', payload);
Â  Â  });
Â  };

Â  useEffect(() => {
Â  Â  // ì›¹ì—ì„œ FCM í† í°ì„ ìˆ˜ì‹ í•˜ëŠ” í•¸ë“¤ëŸ¬
Â  Â  getWebFcmToken();
Â  Â  // ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
Â  Â  const cleanupMessageListener = setupFcmMessageListener();
Â  Â  return () => {
Â  Â  Â  if (typeof cleanupMessageListener === 'function') {
Â  Â  Â  Â  cleanupMessageListener();
Â  Â  Â  }
Â  Â  };
Â  }, []);
Â  return null;
};
export default WebViewMessageHandler;
```


### í‘¸ì‹œ ì•Œë¦¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
ì´ì œê¹Œì§€ ì„¤ì •í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³¼ ì°¨ë¡€ì…ë‹ˆë‹¤. ì•„ë˜ëŠ” í…ŒìŠ¤íŠ¸ ê³¼ì •ì…ë‹ˆë‹¤.
#### 1. WebViewMessageHandler ì»´í¬ë„ŒíŠ¸ ë“±ë¡

ë¨¼ì €, `WebViewMessageHandler` ì»´í¬ë„ŒíŠ¸ë¥¼ ì½”ë“œì— ë“±ë¡í•´ ì£¼ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ í•´ë‹¹ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![[Pasted image 20250313211913.png]]

#### 2. Firebaseì—ì„œ í‘¸ì‹œ ì•Œë¦¼ ì„¤ì •

Firebaseì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ì„¤ì •í•˜ëŠ” ì ˆì°¨ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. **ìº í˜ì¸ ë§Œë“¤ê¸°**  
    Firebase ì½˜ì†”ì—ì„œ **í”„ë¡œì íŠ¸ â†’ Messaging**ìœ¼ë¡œ ì´ë™í•œ í›„, ì²« ë²ˆì§¸ ìº í˜ì¸ì„ ë§Œë“­ë‹ˆë‹¤.
    
    ![[Pasted image 20250313211613.png]]
    
2. **ì•Œë¦¼ ë©”ì‹œì§€ ë§Œë“¤ê¸°**  
    Firebaseì—ì„œ **ì•Œë¦¼ ë©”ì‹œì§€ â†’ ë§Œë“¤ê¸°** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
    
    ![[Pasted image 20250313211705.png]]
    
3. **ì•Œë¦¼ ì œëª© ë° ë‚´ìš© ì…ë ¥**  
    ì•Œë¦¼ ì œëª©ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³ , í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
    
    ![[Pasted image 20250313212207.png]]
    
4. **FCM í† í° ë“±ë¡ ë° í…ŒìŠ¤íŠ¸**  
    FCM í† í°ì„ ë“±ë¡í•œ í›„, í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ì •ìƒì ìœ¼ë¡œ ì „ì†¡ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    
    ![[Pasted image 20250313212343.png]]  
    
    

#### 3. Foreground í…ŒìŠ¤íŠ¸
![[Pasted image 20250313213039.png]]
í‘¸ì‹œ ì•Œë¦¼ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤ë©´, Foregroundì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©”ì‹œì§€ê°€ í™”ë©´ì— ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 4. Background í…ŒìŠ¤íŠ¸

ê·¸ë ‡ë‹¤ë©´ Background ìƒíƒœì—ì„œë„ í‘¸ì‹œ ì•Œë¦¼ì´ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ë‹ˆë‹¤.

![[Pasted image 20250313213159.png]]

ìœ„ì™€ ê°™ì´ Backgroundì—ì„œë„ ì•Œë¦¼ì´ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.